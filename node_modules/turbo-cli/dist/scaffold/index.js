var program=require("commander"),shell=require("shelljs"),path=require("path"),fs=require("fs"),utils=require("../utils"),reactDependencies=require("../default/packagejson/react.json"),dotenv=require("dotenv"),VERTEX_NPM_VERSION="^0.25.42",nextSteps=function(e){console.log("\n- - - - - Next Steps - - - - - "),console.log("1. $ cd "+e),console.log("2. $ npm install"),console.log("3. $ turbo devserver"),console.log("4. Open http://localhost:3000 in a browser"),console.log("5. Build awesome website, app, SAAS product etc."),console.log("6. Sell startup to Mega Tech Inc. and become billionaire"),console.log("7. Start reality TV show"),console.log("8. (10 years later) enter re-hab"),console.log("9. Sell movie rights to Mega Tech Studios, LLC"),console.log("10. Repeat"),console.log("- - - - - - - - - - - - - - - - -\n"),console.log("For full documentation, visit https://www.turbo360.co\n")},importVectors=function(e){e.mkdir("-p","vectors"),e.mkdir("-p","vectors/js"),e.mkdir("-p","vectors/py"),e.cp("-R",path.join(__dirname,"../default/lambda/js/index.js"),"vectors/js/index.js"),e.cp("-R",path.join(__dirname,"../default/lambda/py/requirements.txt"),"vectors/py/requirements.txt"),e.cp("-R",path.join(__dirname,"../default/lambda/py/app.py"),"vectors/py/app.py")};module.exports=function(e,t,r,a){var i=process.platform;if("fullstack"==r||"server"==r)return void console.log("The "+r+" scaffold option has been deprected. Please use --vertex instead.");if("vertex"==r){e.cp("-R",path.join(__dirname,"../default/vertex/gitignore.txt"),".gitignore"),e.cp("-R",path.join(__dirname,"../default/vertex/env.txt"),".env"),e.cp("-R",path.join(__dirname,"../default/vertex/app.js"),"app.js"),e.cp("-R",path.join(__dirname,"../default/vertex/README.md"),"README.md"),e.cp("-R",path.join(__dirname,"../default/templates/DOCUMENTATION.md"),"DOCUMENTATION.md"),e.mkdir("-p","bin"),e.cp("-R",path.join(__dirname,"../default/vertex/bin/*"),"bin/"),e.mkdir("-p","routes"),e.cp("-R",path.join(__dirname,"../default/vertex/routes/*"),"routes/"),e.mkdir("-p","views"),e.cp("-R",path.join(__dirname,"../default/vertex/views/index.mustache"),"views/index.mustache"),e.cd("views"),e.mkdir("-p","partials"),e.cd(".."),e.cp("-R",path.join(__dirname,"../default/vertex/views/partials/head.mustache"),"views/partials/head.mustache"),e.mkdir("-p","public"),e.mkdir("-p","public/css"),e.cp("-R",path.join(__dirname,"../default/vertex/public/css/*"),"public/css/"),e.mkdir("-p","public/images"),e.cp("-R",path.join(__dirname,"../default/vertex/public/images/turbo.png"),"public/images/turbo.png"),e.mkdir("-p","public/js"),e.cp("-R",path.join(__dirname,"../default/vertex/public/js/*"),"public/js/");var s={start:"node ./bin/www",test:"",build:"",postinstall:"turbo postinstall"},p={name:t,version:"0.0.0",server:!1,private:!0,scripts:s,dependencies:{turbo360:"latest",vertex360:VERTEX_NPM_VERSION,accepts:"^1.3.5","array-flatten":"1.1.1","body-parser":"1.18.2","content-disposition":"0.5.2","content-type":"^1.0.4",cookie:"0.3.1","cookie-signature":"1.0.6",debug:"2.6.9",depd:"^1.1.2",encodeurl:"^1.0.2","escape-html":"^1.0.3",etag:"^1.8.1",finalhandler:"1.1.1",fresh:"0.5.2","merge-descriptors":"1.0.1",methods:"^1.1.2","on-finished":"^2.3.0",parseurl:"^1.3.2","path-to-regexp":"0.1.7","proxy-addr":"^2.0.3",qs:"6.5.1","range-parser":"^1.2.0",rimraf:"^2.6.2","safe-buffer":"5.1.1",send:"0.16.2","serve-static":"1.13.2",setprototypeof:"1.1.0",statuses:"^1.4.0","type-is":"^1.6.16","utils-merge":"1.0.1",vary:"^1.1.2"},devDependencies:{express:"latest",nodemon:"^1.17.1"},deploy:["."],format:"vertex"};return utils.write("package.json",JSON.stringify(p,null,2)+"\n"),void utils.readFile("README.md").then(function(e){null!=e&&(e=e.replace("{{title}}",t),utils.write("README.md",e+"\n")),nextSteps(t)}).catch(function(e){})}if("react"==r){e.cp("-R",path.join(__dirname,"../default/vertex/gitignore.txt"),".gitignore"),e.cp("-R",path.join(__dirname,"../default/vertex/env.txt"),".env"),e.cp("-R",path.join(__dirname,"../default/vertex/app.js"),"app.js"),e.cp("-R",path.join(__dirname,"../default/vertex/README.md"),"README.md"),e.cp("-R",path.join(__dirname,"../default/vertex/webpack.config.js"),"webpack.config.js"),e.cp("-R",path.join(__dirname,"../default/vertex/gulpfile.js"),"gulpfile.js"),e.cp("-R",path.join(__dirname,"../default/templates/DOCUMENTATION.md"),"DOCUMENTATION.md"),e.mkdir("-p","bin"),e.cp("-R",path.join(__dirname,"../default/vertex/bin/*"),"bin/"),e.mkdir("-p","routes"),e.cp("-R",path.join(__dirname,"../default/vertex/routes/*"),"routes/"),e.mkdir("-p","views"),e.cp("-R",path.join(__dirname,"../default/vertex/views/react.mustache"),"views/index.mustache"),e.cd("views"),e.mkdir("-p","partials"),e.cd(".."),e.cp("-R",path.join(__dirname,"../default/vertex/views/partials/head.mustache"),"views/partials/head.mustache"),e.mkdir("-p","public"),e.mkdir("-p","public/css"),e.cp("-R",path.join(__dirname,"../default/vertex/public/css/*"),"public/css/"),e.mkdir("-p","public/images"),e.cp("-R",path.join(__dirname,"../default/vertex/public/images/*"),"public/images/"),e.mkdir("-p","public/js"),e.cp("-R",path.join(__dirname,"../default/vertex/public/js/*"),"public/js/"),e.mkdir("-p","src"),e.cp("-R",path.join(__dirname,"../default/client/src/*"),"src/");var s={start:"node ./bin/www",dev:"webpack --mode development -w",build:"npm run clean && NODE_ENV=production webpack -p && gulp prod",clean:"rm -rf ./public/dist",postinstall:"npm run build"};"win32"==i&&(s.clean="rimraf ./public/dist",s.build="npm run clean && cross-env NODE_ENV=production webpack -p && gulp prod");var n={turbo360:"latest",vertex360:VERTEX_NPM_VERSION,bluebird:"^3.5.1",debug:"^3.1.0",dotenv:"^5.0.1",moment:"^2.20.1",superagent:"^3.8.2",accepts:"^1.3.5","array-flatten":"1.1.1","body-parser":"1.18.2","content-disposition":"0.5.2","content-type":"^1.0.4",cookie:"0.3.1","cookie-signature":"1.0.6",debug:"2.6.9",depd:"^1.1.2",encodeurl:"^1.0.2","escape-html":"^1.0.3",etag:"^1.8.1",finalhandler:"1.1.1",fresh:"0.5.2","merge-descriptors":"1.0.1",methods:"^1.1.2","on-finished":"^2.3.0",parseurl:"^1.3.2","path-to-regexp":"0.1.7","proxy-addr":"^2.0.3",qs:"6.5.1","range-parser":"^1.2.0","safe-buffer":"5.1.1",send:"0.16.2","serve-static":"1.13.2",setprototypeof:"1.1.0",statuses:"^1.4.0","type-is":"^1.6.16","utils-merge":"1.0.1",vary:"^1.1.2"};reactDependencies.dependencies.forEach(function(e){var t=e.split("@");2==t.length&&(n[t[0]]="^"+t[1])});var o={chai:"^4.1.2","chai-http":"^3.0.0",mocha:"^5.0.1","mocha-jscs":"^5.0.1","mocha-jshint":"^2.3.1",nodemon:"^1.17.1",rimraf:"^2.6.2"};reactDependencies.devDependencies.forEach(function(e){var t=e.split("@");2==t.length&&(o[t[0]]="^"+t[1])});var p={name:t,version:"0.0.0",server:!1,private:!0,scripts:s,dependencies:n,devDependencies:o,deploy:["."],format:"vertex",app:""};utils.write("package.json",JSON.stringify(p,null,2)+"\n"),utils.readFile("README.md").then(function(e){null!=e&&(e=e.replace("{{title}}",t),utils.write("README.md",e+"\n")),nextSteps(t)}).catch(function(e){})}if("graphql"==r){e.cp("-R",path.join(__dirname,"../default/vertex/gitignore.txt"),".gitignore"),e.cp("-R",path.join(__dirname,"../default/vertex/env.txt"),".env"),e.cp("-R",path.join(__dirname,"../default/vertex/app.js"),"app.js"),e.cp("-R",path.join(__dirname,"../default/vertex/README.md"),"README.md"),e.cp("-R",path.join(__dirname,"../default/templates/DOCUMENTATION.md"),"DOCUMENTATION.md"),e.mkdir("-p","bin"),e.cp("-R",path.join(__dirname,"../default/vertex/bin/*"),"bin/"),e.mkdir("-p","routes"),e.cp("-R",path.join(__dirname,"../default/vertex/routes/*"),"routes/"),e.mkdir("-p","views"),e.cp("-R",path.join(__dirname,"../default/vertex/views/index.mustache"),"views/index.mustache"),e.cd("views"),e.mkdir("-p","partials"),e.cd(".."),e.cp("-R",path.join(__dirname,"../default/vertex/views/partials/head.mustache"),"views/partials/head.mustache"),e.mkdir("-p","public"),e.mkdir("-p","public/css"),e.cp("-R",path.join(__dirname,"../default/vertex/public/css/*"),"public/css/"),e.mkdir("-p","public/images"),e.cp("-R",path.join(__dirname,"../default/vertex/public/images/turbo.png"),"public/images/turbo.png"),e.mkdir("-p","public/js"),e.cp("-R",path.join(__dirname,"../default/vertex/public/js/*"),"public/js/");var s={start:"node ./bin/www",test:"",build:""},p={name:t,version:"0.0.0",server:!1,private:!0,scripts:s,dependencies:{turbo360:"latest",vertex360:VERTEX_NPM_VERSION,accepts:"^1.3.5","array-flatten":"1.1.1","body-parser":"1.18.2","content-disposition":"0.5.2","content-type":"^1.0.4",cookie:"0.3.1","cookie-signature":"1.0.6",debug:"2.6.9",depd:"^1.1.2",encodeurl:"^1.0.2","escape-html":"^1.0.3",etag:"^1.8.1","express-graphql":"^0.7.1",finalhandler:"1.1.1",fresh:"0.5.2",graphql:"^14.0.2","merge-descriptors":"1.0.1",methods:"^1.1.2","on-finished":"^2.3.0",parseurl:"^1.3.2","path-to-regexp":"0.1.7","proxy-addr":"^2.0.3",qs:"6.5.1","range-parser":"^1.2.0",rimraf:"^2.6.2","safe-buffer":"5.1.1",send:"0.16.2","serve-static":"1.13.2",setprototypeof:"1.1.0",statuses:"^1.4.0","type-is":"^1.6.16","utils-merge":"1.0.1",vary:"^1.1.2"},devDependencies:{express:"latest",nodemon:"^1.17.1"},deploy:["."],format:"vertex"};return utils.write("package.json",JSON.stringify(p,null,2)+"\n"),void utils.readFile("README.md").then(function(e){null!=e&&(e=e.replace("{{title}}",t),utils.write("README.md",e+"\n")),nextSteps(t)}).catch(function(e){})}if("template"==r){if(null==a){e.mkdir("-p","models");var d=fs.existsSync(path.join(__dirname,"../template/"+t+"/models"));d&&e.cp("-R",path.join(__dirname,"../template/"+t+"/models/*"),"models/"),e.mkdir("-p","controllers"),e.cp("-R",path.join(__dirname,"../template/"+t+"/controllers/*"),"controllers/");var l=require("../template/"+t+"/shared");l.forEach(function(t){e.cp("-R",path.join(__dirname,"../template/shared/controllers/"+t+"Controller.js"),"controllers/"),e.cp("-R",path.join(__dirname,"../template/shared/models/"+t+".js"),"models/")}),e.mkdir("-p","pages"),e.cp("-R",path.join(__dirname,"../template/shared/pages/*"),"pages/"),e.cp("-R",path.join(__dirname,"../template/shared/routes/page.js"),"routes/"),e.cp("-R",path.join(__dirname,"../template/shared/routes/vertex.js"),"routes/"),e.cp("-R",path.join(__dirname,"../template/shared/views/home.mustache"),"views/"),e.cp("-R",path.join(__dirname,"../template/shared/app.js"),"app.js"),e.mkdir("-p","tmp");var c=fs.readdirSync("models");return e.cd("tmp"),c.forEach(function(e){var t=e.replace(".js","").toLowerCase()+"s";utils.write(t+".db","")}),e.cd(".."),void utils.readFile(".env").then(function(e){if(null!=e){var t=dotenv.parse(e);t.TMP_DIR="/tmp";["TURBO_API_KEY","TURBO_APP_ID","TURBO_APP_SLUG","SESSION_SECRET"].forEach(function(e){null==t[e]&&(t[e]="<"+e+">")});var r="";return Object.keys(t).forEach(function(e,a){null!=t[e]&&(r+=e+"="+t[e]+"\n")}),utils.write(".env",r),utils.readFile("package.json")}}).then(function(e){var t=JSON.parse(e);t.scripts.reset="rimraf ./tmp/*",utils.write("package.json",JSON.stringify(t,null,2)+"\n"),console.log("Template successfully configured.")}).catch(function(e){console.log("ERROR - "+e.message)})}e.cp("-R",path.join(__dirname,"../default/vertex/gitignore.txt"),".gitignore"),e.cp("-R",path.join(__dirname,"../default/vertex/README.md"),"README.md"),e.cp("-R",path.join(__dirname,"../default/templates/DOCUMENTATION.md"),"DOCUMENTATION.md"),e.mkdir("-p","bin"),e.cp("-R",path.join(__dirname,"../default/vertex/bin/*"),"bin/"),e.cp("-R",path.join(__dirname,"../template/shared/app.js"),"app.js"),e.cp("-R",path.join(__dirname,"../template/shared/env.txt"),".env"),e.mkdir("-p","routes"),e.cp("-R",path.join(__dirname,"../template/shared/routes/page.js"),"routes/"),e.cp("-R",path.join(__dirname,"../template/shared/routes/vertex.js"),"routes/"),e.mkdir("-p","models");var d=fs.existsSync(path.join(__dirname,"../template/"+t+"/models"));d&&e.cp("-R",path.join(__dirname,"../template/"+t+"/models/*"),"models/"),e.mkdir("-p","controllers"),e.cp("-R",path.join(__dirname,"../template/"+t+"/controllers/*"),"controllers/");var l=require("../template/"+t+"/shared");l.forEach(function(t){e.cp("-R",path.join(__dirname,"../template/shared/controllers/"+t+"Controller.js"),"controllers/"),e.cp("-R",path.join(__dirname,"../template/shared/models/"+t+".js"),"models/")}),e.mkdir("-p","pages"),e.cp("-R",path.join(__dirname,"../template/shared/pages/*"),"pages/"),e.mkdir("-p","tmp"),e.mkdir("-p","views"),e.cp("-R",path.join(__dirname,"../template/shared/views/home.mustache"),"views/home.mustache"),e.cd("views"),e.mkdir("-p","partials"),e.cd(".."),e.cp("-R",path.join(__dirname,"../default/vertex/views/partials/head.mustache"),"views/partials/head.mustache"),e.mkdir("-p","public"),e.mkdir("-p","public/css"),e.cp("-R",path.join(__dirname,"../default/vertex/public/css/*"),"public/css/"),e.mkdir("-p","public/js"),e.cp("-R",path.join(__dirname,"../default/vertex/public/js/*"),"public/js/");var s={start:"node ./bin/www",reset:"rimraf ./tmp/*",test:"",build:"",postinstall:"turbo postinstall"},p={name:t,version:"0.0.0",server:!1,private:!0,scripts:s,dependencies:{turbo360:"latest",vertex360:VERTEX_NPM_VERSION,accepts:"^1.3.5","array-flatten":"1.1.1","body-parser":"1.18.2","content-disposition":"0.5.2","content-type":"^1.0.4",cookie:"0.3.1","cookie-signature":"1.0.6",debug:"2.6.9",depd:"^1.1.2",encodeurl:"^1.0.2","escape-html":"^1.0.3",etag:"^1.8.1",finalhandler:"1.1.1",fresh:"0.5.2","merge-descriptors":"1.0.1",methods:"^1.1.2","on-finished":"^2.3.0",parseurl:"^1.3.2","path-to-regexp":"0.1.7","proxy-addr":"^2.0.3",qs:"6.5.1","range-parser":"^1.2.0",rimraf:"^2.6.2","safe-buffer":"5.1.1",send:"0.16.2","serve-static":"1.13.2",setprototypeof:"1.1.0",statuses:"^1.4.0","type-is":"^1.6.16","utils-merge":"1.0.1",vary:"^1.1.2"},devDependencies:{express:"latest",nodemon:"^1.17.1"},deploy:["."],format:"vertex"};return utils.write("package.json",JSON.stringify(p,null,2)+"\n"),void utils.readFile("README.md").then(function(e){return null!=e&&(e=e.replace("{{title}}",t),utils.write("README.md",e+"\n")),utils.readFile(".env")}).then(function(e){null!=e&&(e=e.replace("{{TURBO_APP_ID}}",a.siteId),e=e.replace("{{TURBO_APP_SLUG}}",a.slug),e=e.replace("{{TURBO_API_KEY}}",a.apiKey),e=e.replace("{{slug}}",a.slug),utils.write(".env",e+"\n")),nextSteps(a.slug)}).catch(function(e){console.log("ERR: "+e.message)})}};