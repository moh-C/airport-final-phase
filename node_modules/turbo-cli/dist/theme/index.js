var Promise=require("bluebird"),shell=require("shelljs"),path=require("path"),fs=require("fs"),themes={standard:"https://velocity-360@bitbucket.org/velocity-360/standard.git",hyperspace:"https://velocity-360@bitbucket.org/velocity-360/hyperspace.git",prologue:"https://velocity-360@bitbucket.org/velocity-360/prologue.git",editorial:"https://velocity-360@bitbucket.org/velocity-360/editorial.git",stack:"https://velocity-360@bitbucket.org/velocity-360/stack.git"},staticThemes={hyperspace:"https://velocity-360@bitbucket.org/velocity-360/hyperspace-static.git",editorial:"https://velocity-360@bitbucket.org/velocity-360/editorial-static.git",strata:"https://velocity-360@bitbucket.org/velocity-360/strata-static.git","future-imperfect":"https://velocity-360@bitbucket.org/velocity-360/future-imperfect-static.git","strongly-typed":"https://velocity-360@bitbucket.org/velocity-360/strongly-typed-static.git",story:"https://velocity-360@bitbucket.org/velocity-360/story-static.git",landed:"https://velocity-360@bitbucket.org/velocity-360/landed-static.git",readonly:"https://velocity-360@bitbucket.org/velocity-360/readonly-static.git",phantom:"https://velocity-360@bitbucket.org/velocity-360/phantom-static.git",twenty:"https://velocity-360@bitbucket.org/velocity-360/twenty-static.git"},vertexThemes={twenty:"https://velocity-360@bitbucket.org/velocity-360/twenty-vertex.git",hyperspace:"https://velocity-360@bitbucket.org/velocity-360/hyperspace-vertex.git",phantom:"https://velocity-360@bitbucket.org/velocity-360/phantom-vertex.git",readonly:"https://velocity-360@bitbucket.org/velocity-360/readonly-vertex.git",editorial:"https://velocity-360@bitbucket.org/velocity-360/editorial-vertex.git","future-imperfect":"https://velocity-360@bitbucket.org/velocity-360/future-imperfect-vertex.git",landed:"https://velocity-360@bitbucket.org/velocity-360/landed-vertex.git",story:"https://velocity-360@bitbucket.org/velocity-360/story-vertex.git",strata:"https://velocity-360@bitbucket.org/velocity-360/strata-vertex.git","strongly-typed":"https://velocity-360@bitbucket.org/velocity-360/strongly-typed-vertex.git"},readFile=function(e){return new Promise(function(t,s){fs.readFile(e,"utf8",function(e,l){e&&s(e),t(l)})})};module.exports={configureTheme:function(e){console.log("configureTheme: "+e),readFile("package.json").then(function(t){var s=JSON.parse(t),l=null;if("vertex"==s.format){if(l=vertexThemes[e],0!==shell.exec("git clone "+l).code)return void shell.echo("Error: Git clone failed");var i=e+"-vertex";return shell.rm("-rf","public"),(shell.mkdir("-p","public"),shell.cp("-R",i+"/assets/*","public/"),null==s.dependencies.react)?(shell.cp("-R",i+"/index.mustache","views/index.mustache"),shell.rm("-rf",i),void shell.echo("\n* * * * * * * * * * * * * * * * * *\nTheme "+e+" successfully integrated.\n* * * * * * * * * * * * * * * * * * \n")):(shell.cp("-R",i+"/react/index.mustache","views/index.mustache"),shell.cd("src"),shell.mkdir("-p","theme"),shell.cd(".."),shell.cp("-R",i+"/react/Theme.js","src/theme/Theme.js"),shell.cp("-R",i+"/react/entry.js","src/index.js"),shell.rm("-rf",i),shell.exec("webpack"),void shell.echo("\n* * * * * * * * * * * * * * * * * *\nTheme "+e+" successfully integrated.\nCheck the src/index.js for the implementation as well as src/theme/Theme.js for the components.\n* * * * * * * * * * * * * * * * * * \n"))}if(null==s.dependencies.react){if(l=staticThemes[e],0!==shell.exec("git clone "+l).code)return void shell.echo("Error: Git clone failed");var i=e+"-static";return shell.rm("-rf","assets"),shell.mkdir("-p","assets"),shell.cp("-R",i+"/assets/*","assets/"),shell.cp("-R",i+"/gulpfile.js","gulpfile.js"),shell.cp("-R",i+"/index.html","index.html"),shell.rm("-rf",i),void shell.exec("npm run build")}return null==(l=themes[e])?(shell.cp("-R",path.join(__dirname,"../default/gulp/gulpfile.js"),"gulpfile.js"),shell.cp("-R",path.join(__dirname,"../default/templates/index.html"),"index.html"),shell.mkdir("-p","assets"),shell.cp("-R",path.join(__dirname,"../default/assets/*"),"assets/"),shell.cp("-R",path.join(__dirname,"../default/client/src/index.js"),"src/index.js"),shell.rm("-rf","src/components/presentation/*"),shell.mkdir("-p","src/components/presentation"),shell.cp("-R",path.join(__dirname,"../default/client/src/components/presentation/*"),"src/components/presentation/"),void shell.exec("npm run build")):0!==shell.exec("git clone "+l).code?void shell.echo("Error: Git clone failed"):(shell.rm("-rf","src/theme"),shell.mkdir("-p","src/theme"),shell.cp("-R",e+"/theme/*","src/theme/"),shell.rm("-rf","assets"),shell.mkdir("-p","assets"),shell.cp("-R",e+"/assets/*","assets"),shell.rm("-rf","src/components/presentation"),shell.cp("-R",e+"/gulpfile.js","gulpfile.js"),shell.cp("-R",e+"/index.js","src/index.js"),shell.rm("-rf",e),void shell.exec("npm run build"))}).catch(function(e){})},staticThemes:function(){return Object.keys(staticThemes)},reactThemes:function(){return Object.keys(themes)},vertexThemes:function(){return Object.keys(vertexThemes)}};